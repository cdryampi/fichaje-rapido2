{% extends "base.html" %}

{% block content %}
<section class="pdf-page">
  <div class="header">
    <h2>Visor de PDF</h2>
    <p class="muted">Sube un documento PDF y visualizalo al instante sin salir de la aplicacion.</p>
  </div>
  <div class="pdf-layout">
    <section class="card pdf-uploader">
      <h3>Selecciona un archivo</h3>
      <p class="muted">Solo se admiten archivos en formato PDF. El documento se carga de forma local en tu navegador.</p>
      <label class="file-picker">
        <input type="file" id="pdf-file-input" accept="application/pdf" />
        <span class="file-picker__hint">
          <i data-lucide="file-input" class="icon"></i>
          <span data-file-name>Selecciona un PDF desde tu equipo</span>
        </span>
      </label>
      <button type="button" class="btn btn-green" id="load-pdf-button">
        <i data-lucide="upload-cloud" class="icon"></i>
        Cargar PDF
      </button>
      <p class="muted small">El PDF no se guarda en el servidor; se muestra solo para ti.</p>
    </section>
    <section class="card pdf-viewer">
      <h3>Vista previa</h3>
      <div class="pdf-viewer__frame" data-pdf-container>
        <div class="pdf-placeholder" data-pdf-placeholder>
          <i data-lucide="file-text" class="icon"></i>
          <p class="muted">Sube un PDF y pulsa "Cargar PDF" para visualizarlo.</p>
        </div>
        <iframe title="Visor de PDF" data-pdf-viewer></iframe>
      </div>
    </section>
  </div>
</section>
<style>
  .pdf-page{display:flex;flex-direction:column;gap:16px}
  .pdf-layout{display:flex;flex-direction:column;gap:16px}
  .pdf-uploader,.pdf-viewer{flex:1}
  .pdf-uploader h3,.pdf-viewer h3{margin-top:0;margin-bottom:12px}
  .pdf-viewer__frame{position:relative;min-height:360px;border:1px dashed #d0d0d0;border-radius:12px;overflow:hidden;background:#fafafa}
  .pdf-viewer__frame iframe{display:none;width:100%;height:100%;border:0;background:#fff}
  .pdf-viewer__frame iframe.is-visible{display:block}
  .pdf-placeholder{position:absolute;inset:0;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;text-align:center;padding:24px;color:#666}
  .pdf-placeholder .icon{width:36px;height:36px}
  .pdf-placeholder.is-hidden{display:none}
  .file-picker{display:flex;align-items:center;justify-content:center;gap:12px;padding:16px;border:1px dashed #bbb;border-radius:12px;background:#fff;cursor:pointer;transition:border-color .2s ease,background-color .2s ease}
  .file-picker:hover{border-color:#888;background:#f5f5f5}
  .file-picker input{display:none}
  .file-picker__hint{display:flex;gap:10px;align-items:center;color:#333;font-weight:600}
  .file-picker__hint .icon{width:20px;height:20px}
  .muted.small{font-size:13px}
  @media (min-width:900px){
    .pdf-layout{flex-direction:row;align-items:stretch}
    .pdf-uploader{flex:0 0 320px}
  }
</style>
<script>
  (function(){
    var fileInput = document.getElementById("pdf-file-input");
    var loadButton = document.getElementById("load-pdf-button");
    var fileNameTarget = document.querySelector("[data-file-name]");
    var viewer = document.querySelector("[data-pdf-viewer]");
    var placeholder = document.querySelector("[data-pdf-placeholder]");
    var container = document.querySelector("[data-pdf-container]");
    if (!fileInput || !loadButton || !viewer || !container) { return; }
    var currentObjectUrl = null;

    fileInput.addEventListener("change", function(){
      if (fileNameTarget) {
        var file = fileInput.files && fileInput.files[0];
        fileNameTarget.textContent = file ? file.name : "Selecciona un PDF desde tu equipo";
      }
    });

    loadButton.addEventListener("click", function(){
      var file = fileInput.files && fileInput.files[0];
      if (!file) {
        alert("Selecciona un archivo PDF antes de cargarlo.");
        return;
      }
      var isPdf = file.type === "application/pdf" || /\.pdf$/i.test(file.name || "");
      if (!isPdf) {
        alert("El archivo seleccionado debe ser un PDF.");
        return;
      }
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }
      currentObjectUrl = URL.createObjectURL(file);
      viewer.src = currentObjectUrl;
      viewer.classList.add("is-visible");
      container.classList.add("has-file");
      if (placeholder) {
        placeholder.classList.add("is-hidden");
      }
      loadButton.blur();
    });

    window.addEventListener("beforeunload", function(){
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
      }
    });
  })();
</script>
{% endblock %}
